data "aws_caller_identity" "current" {}
data "aws_region" "current" {}

data "http" "template_body_wa_security_pillar" {
  url = local.url_template_body_wa_security_pillar
}

data "http" "template_body_wa_reliability_pillar" {
  url = local.url_template_body_wa_reliability_pillar
}

data "http" "template_body_wa_iam_pillar" {
  url = local.url_template_body_wa_iam
}

data "util_replace" "transformed_wa_security_pillar" {
  content = data.http.template_body_wa_security_pillar.response_body
  replacements = {
    "account-part-of-organizations" : "SEC01-account-part-of-organizations",
    "ec2-instance-managed-by-systems-manager" : "SEC01-ec2-instance-managed-by-systems-manager",
    "codebuild-project-envvar-awscred-check" : "SEC01-codebuild-project-envvar-awscred-check",
    "mfa-enabled-for-iam-console-access" : "SEC02-mfa-enabled-for-iam-console-access",
    "iam-user-mfa-enabled" : "SEC02-iam-user-mfa-enabled",
    "iam-root-access-key-check" : "SEC02-iam-root-access-key-check",
    "root-account-hardware-mfa-enabled" : "SEC02-root-account-hardware-mfa-enabled",
    "root-account-mfa-enabled" : "SEC02-root-account-mfa-enabled",
    "iam-password-policy" : "SEC02-iam-password-policy",
    "iam-group-has-users-check" : "SEC02-iam-group-has-users-check",
    "access-keys-rotated" : "SEC02-access-keys-rotated",
    "iam-user-group-membership-check" : "SEC02-iam-user-group-membership-check",
    "iam-user-unused-credentials-check" : "SEC02-iam-user-unused-credentials-check",
    "secretsmanager-rotation-enabled-check" : "SEC02-secretsmanager-rotation-enabled-check"
    "secretsmanager-scheduled-rotation-success-check" : "SEC02-secretsmanager-scheduled-rotation-success-check",
    "secretsmanager-secret-periodic-rotation" : "SEC02-secretsmanager-secret-periodic-rotation",
    "secretsmanager-secret-unused" : "SEC02-secretsmanager-secret-unused",
    "dms-replication-not-public" : "SEC03-dms-replication-not-public",
    "iam-no-inline-policy-check" : "SEC03-iam-no-inline-policy-check",
    "iam-policy-no-statements-with-admin-access" : "SEC03-iam-policy-no-statements-with-admin-access",
    "iam-user-no-policies-check" : "SEC03-iam-user-no-policies-check",
    "iam-policy-no-statements-with-full-access" : "SEC03-iam-policy-no-statements-with-full-access",
    "iam-customer-policy-blocked-kms-actions" : "SEC03-iam-customer-policy-blocked-kms-actions",
    "ec2-imdsv2-check" : "SEC03-ec2-imdsv2-check",
    "ec2-instance-profile-attached" : "SEC03-ec2-instance-profile-attached",
    "ecs-task-definition-user-for-host-mode-check" : "SEC03-ecs-task-definition-user-for-host-mode-check",
    "ecs-containers-nonprivileged" : "SEC03-ecs-containers-nonprivileged",
    "ecs-containers-readonly-access" : "SEC03-ecs-containers-readonly-access",
    "efs-access-point-enforce-user-identity" : "SEC03-efs-access-point-enforce-user-identity",
    "emr-kerberos-enabled" : "SEC03-emr-kerberos-enabled",
    "ecs-task-definition-nonroot-user" : "SEC03-ecs-task-definition-nonroot-user",
    "cloudtrail-security-trail-enabled" : "SEC04-cloudtrail-security-trail-enabled",
    "multi-region-cloudtrail-enabled" : "SEC04-multi-region-cloudtrail-enabled",
    "cloud-trail-cloud-watch-logs-enabled" : "SEC04-cloud-trail-cloud-watch-logs-enabled",
    "cloudwatch-alarm-action-check" : "SEC04-cloudwatch-alarm-action-check",
    "guardduty-enabled-centralized" : "SEC04-guardduty-enabled-centralized",
    "securityhub-enabled" : "SEC04-securityhub-enabled",
    "cloudtrail-s3-dataevents-enabled" : "SEC04-cloudtrail-s3-dataevents-enabled",
    "api-gw-execution-logging-enabled" : "SEC04-api-gw-execution-logging-enabled",
    "cloudwatch-log-group-encrypted" : "SEC04-cloudwatch-log-group-encrypted",
    "s3-bucket-logging-enabled" : "SEC04-s3-bucket-logging-enabled",
    "vpc-flow-logs-enabled" : "SEC04-vpc-flow-logs-enabled",
    "elb-logging-enabled" : "SEC04-elb-logging-enabled",
    "rds-logging-enabled" : "SEC04-rds-logging-enabled",
    "wafv2-logging-enabled" : "SEC04-wafv2-logging-enabled",
    "opensearch-audit-logging-enabled" : "SEC04-opensearch-audit-logging-enabled",
    "ec2-managedinstance-patch-compliance-status-check" : "SEC04-ec2-managedinstance-patch-compliance-status-check",
    "ec2-managedinstance-association-compliance-status-check" : "SEC04-ec2-managedinstance-association-compliance-status-check",
    "elastic-beanstalk-managed-updates-enabled" : "SEC04-elastic-beanstalk-managed-updates-enabled",
    "rds-automatic-minor-version-upgrade-enabled" : "SEC04-rds-automatic-minor-version-upgrade-enabled",
    "opensearch-logs-to-cloudwatch" : "SEC04-opensearch-logs-to-cloudwatch",
    "elasticsearch-logs-to-cloudwatch" : "SEC04-elasticsearch-logs-to-cloudwatch",
    "ecs-container-insights-enabled" : "SEC04-ecs-container-insights-enabled",
    "redshift-cluster-maintenancesettings-check" : "SEC04-redshift-cluster-maintenancesettings-check",
    "cw-loggroup-retention-period" : "SEC04-cw-loggroup-retention-period",
    "autoscaling-group-elb-healthcheck-required" : "SEC05-autoscaling-group-elb-healthcheck-required",
    "cloudwatch-alarm-action-check" : "SEC05-cloudwatch-alarm-action-check",
    "dynamodb-autoscaling-enabled" : "SEC05-dynamodb-autoscaling-enabled",
    "elasticache-redis-cluster-automatic-backup-check" : "SEC05-elasticache-redis-cluster-automatic-backup-check",
    "rds-instance-deletion-protection-enabled" : "SEC05-rds-instance-deletion-protection-enabled",
    "rds-multi-az-support" : "SEC05-rds-multi-az-support",
    "vpc-vpn-2-tunnels-up" : "SEC05-vpc-vpn-2-tunnels-up",
    "dynamodb-in-backup-plan" : "SEC05-dynamodb-in-backup-plan",
    "ec2-security-group-attached-to-eni-periodic" : "SEC05-ec2-security-group-attached-to-eni-periodic",
    "ec2-instance-no-public-ip" : "SEC05-ec2-instance-no-public-ip",
    "emr-master-no-public-ip" : "SEC05-emr-master-no-public-ip",
    "restricted-common-ports" : "SEC05-restricted-common-ports",
    "elasticsearch-in-vpc-only" : "SEC05-elasticsearch-in-vpc-only",
    "opensearch-in-vpc-only" : "SEC05-opensearch-in-vpc-only",
    "rds-snapshots-public-prohibited" : "SEC05-rds-snapshots-public-prohibited",
    "internet-gateway-authorized-vpc-only" : "SEC05-internet-gateway-authorized-vpc-only",
    "lambda-function-public-access-prohibited" : "SEC05-lambda-function-public-access-prohibited",
    "no-unrestricted-route-to-igw" : "SEC05-no-unrestricted-route-to-igw",
    "rds-instance-public-access-check" : "SEC05-rds-instance-public-access-check",
    "redshift-cluster-public-access-check" : "SEC05-redshift-cluster-public-access-check",
    "redshift-enhanced-vpc-routing-enabled" : "SEC05-redshift-enhanced-vpc-routing-enabled",
    "restricted-ssh" : "SEC05-restricted-ssh",
    "ec2-instances-in-vpc" : "SEC05-ec2-instances-in-vpc",
    "acm-certificate-expiration-check" : "SEC05-acm-certificate-expiration-check",
    "ec2-instance-multiple-eni" : "SEC05-ec2-instance-multiple-eni",
    "subnet-auto-assign-public-ip-disabled" : "SEC05-subnet-auto-assign-public-ip-disabled",
    "ec2-volume-inuse-check" : "SEC06-ec2-volume-inuse-check",
    "cloud-trail-log-file-validation-enabled" : "SEC06-cloud-trail-log-file-validation-enabled",
    "ecs-fargate-latest-platform-version" : "SEC06-ecs-fargate-latest-platform-version",
    "ec2-instance-profile-attached" : "SEC06-ec2-instance-profile-attached",
    "ec2-instance-managed-by-systems-manager" : "SEC06-ec2-instance-managed-by-systems-manager",
    "ec2-stopped-instance" : "SEC06-ec2-stopped-instance",
    "ecr-private-image-scanning-enabled" : "SEC06-ecr-private-image-scanning-enabled",
    "autoscaling-launch-config-public-ip-disabled" : "SEC06-autoscaling-launch-config-public-ip-disabled"
    "s3-account-level-public-access-blocks-periodic" : "SEC05-s3-account-level-public-access-blocks-periodic",
    "s3-bucket-level-public-access-prohibited" : "SEC05-s3-bucket-level-public-access-prohibited",
    "s3-bucket-public-read-prohibited" : "SEC05-s3-bucket-public-read-prohibited",
    "s3-bucket-public-write-prohibited" : "SEC05-s3-bucket-public-write-prohibited",
    "sagemaker-notebook-no-direct-internet-access" : "SEC05-sagemaker-notebook-no-direct-internet-access",
    "vpc-default-security-group-closed" : "SEC05-vpc-default-security-group-closed",
    "lambda-inside-vpc" : "SEC05-lambda-inside-vpc",
    "vpc-sg-open-only-to-authorized-ports" : "SEC05-vpc-sg-open-only-to-authorized-ports",
    "ebs-snapshot-public-restorable-check" : "SEC08-ebs-snapshot-public-restorable-check",
    "ebs-in-backup-plan" : "SEC08-ebs-in-backup-plan",
    "efs-in-backup-plan" : "SEC08-efs-in-backup-plan",
    "rds-in-backup-plan" : "SEC08-rds-in-backup-plan",
    "ec2-stopped-instance" : "SEC06-ec2-stopped-instance",
    "ec2-volume-inuse-check" : "SEC06-ec2-volume-inuse-check",
    "ssm-document-not-public" : "SEC06-ssm-document-not-public",
    "vpc-network-acl-unused" : "SEC06-vpc-network-acl-unused",
    "alb-http-drop-invalid-header-enabled" : "SEC08-alb-http-drop-invalid-header-enabled",
    "alb-http-to-https-redirection-check" : "SEC08-alb-http-to-https-redirection-check",
    "api-gw-cache-enabled-and-encrypted" : "SEC08-api-gw-cache-enabled-and-encrypted",
    "backup-recovery-point-encrypted" : "SEC08-backup-recovery-point-encrypted",
    "codebuild-project-artifact-encryption" : "SEC08-codebuild-project-artifact-encryption",
    "codebuild-project-s3-logs-encrypted" : "SEC08-codebuild-project-s3-logs-encrypted",
    "api-gw-ssl-enabled" : "SEC09-api-gw-ssl-enabled",
    "cloudfront-custom-ssl-certificate" : "SEC09-cloudfront-custom-ssl-certificate",
    "cloudfront-default-root-object-configured" : "SEC09-cloudfront-default-root-object-configured",
    "cloudfront-origin-access-identity-enabled" : "SEC09-cloudfront-origin-access-identity-enabled",
    "cloudfront-origin-failover-enabled" : "SEC09-cloudfront-origin-failover-enabled",
    "cloudfront-viewer-policy-https" : "SEC09-cloudfront-viewer-policy-https",
    "elbv2-acm-certificate-required" : "SEC09-elbv2-acm-certificate-required",
    "elb-acm-certificate-required" : "SEC09-elb-acm-certificate-required",
    "elb-tls-https-listeners-only" : "SEC09-elb-tls-https-listeners-only",
    "kms-cmk-not-scheduled-for-deletion" : "SEC09-kms-cmk-not-scheduled-for-deletion",
    "cloud-trail-encryption-enabled" : "SEC09-cloud-trail-encryption-enabled",
    "alb-http-drop-invalid-header-enabled" : "SEC09-alb-http-drop-invalid-header-enabled",
    "elasticsearch-node-to-node-encryption-check" : "SEC09-elasticsearch-node-to-node-encryption-check",
    "opensearch-node-to-node-encryption-check" : "SEC09-opensearch-node-to-node-encryption-check",
    "opensearch-https-required" : "SEC09-opensearch-https-required",
    "redshift-require-tls-ssl" : "SEC09-redshift-require-tls-ssl",
    "s3-bucket-ssl-requests-only" : "SEC09-s3-bucket-ssl-requests-only",
    "dynamodb-table-encrypted" : "SEC08-dynamodb-table-encrypted",
    "cloudwatch-log-group-encrypted" : "SEC08-cloudwatch-log-group-encrypted",
    "dynamodb-table-encrypted-kms" : "SEC08-dynamodb-table-encrypted-kms",
    "ec2-ebs-encryption-by-default" : "SEC08-ec2-ebs-encryption-by-default",
    "efs-encrypted-check" : "SEC08-efs-encrypted-check",
    "elasticsearch-encrypted-at-rest" : "SEC08-elasticsearch-encrypted-at-rest",
    "opensearch-encrypted-at-rest" : "SEC08-opensearch-encrypted-at-rest",
    "encrypted-volumes" : "SEC08-encrypted-volumes",
    "rds-snapshot-encrypted" : "SEC08-rds-snapshot-encrypted",
    "rds-storage-encrypted" : "SEC08-rds-storage-encrypted",
    "redshift-cluster-configuration-check" : "SEC08-redshift-cluster-configuration-check",
    "redshift-cluster-kms-enabled" : "SEC08-redshift-cluster-kms-enabled",
    "s3-bucket-server-side-encryption-enabled" : "SEC08-s3-bucket-server-side-encryption-enabled",
    "s3-default-encryption-kms" : "SEC08-s3-default-encryption-kms",
    "sagemaker-endpoint-configuration-kms-key-configured" : "SEC08-sagemaker-endpoint-configuration-kms-key-configured",
    "sagemaker-notebook-instance-kms-key-configured" : "SEC08-sagemaker-notebook-instance-kms-key-configured",
    "secretsmanager-using-cmk" : "SEC08-secretsmanager-using-cmk",
    "sns-encrypted-kms" : "SEC08-sns-encrypted-kms",
    "s3-bucket-versioning-enabled" : "SEC08-s3-bucket-versioning-enabled",
    "alb-waf-enabled" : "SEC09-alb-waf-enabled",
    "api-gw-associated-with-waf" : "SEC09-api-gw-associated-with-waf",
    "waf-regional-rule-not-empty" : "SEC09-waf-regional-rule-not-empty",
    "waf-regional-rulegroup-not-empty" : "SEC09-waf-regional-rulegroup-not-empty",
    "waf-regional-webacl-not-empty" : "SEC09-waf-regional-webacl-not-empty",
    "guardduty-enabled-centralized" : "SEC09-guardduty-enabled-centralized",
    "guardduty-non-archived-findings" : "SEC09-guardduty-non-archived-findings",
    "guardduty-enabled-centralized" : "SEC10-guardduty-enabled-centralized",
    "cloudtrail-security-trail-enabled" : "SEC10-cloudtrail-security-trail-enabled",
    "cloud-trail-cloud-watch-logs-enabled" : "SEC10-cloud-trail-cloud-watch-logs-enabled",
    "cloudwatch-alarm-action-check" : "SEC10-cloudwatch-alarm-action-check",
    "guardduty-enabled-centralized" : "SEC10-guardduty-enabled-centralized",
    "ec2-instance-managed-by-systems-manager" : "SEC10-ec2-instance-managed-by-systems-manager",
    "guardduty-non-archived-findings" : "SEC10-guardduty-non-archived-findings"
  }
}

data "util_replace" "transformed_wa_reliability_pillar" {
  content = data.http.template_body_wa_reliability_pillar.response_body
  replacements = {
    "dynamodb-throughput-limit-check" : "REL01-dynamodb-throughput-limit-check",
    "ecs-task-definition-memory-hard-limit" : "REL01-ecs-task-definition-memory-hard-limit",
    "elb-cross-zone-load-balancing-enabled" : "REL02-elb-cross-zone-load-balancing-enabled",
    "ec2-instances-in-vpc" : "REL02-ec2-instances-in-vpc",
    "rds-multi-az-support" : "REL02-rds-multi-az-support",
    "redshift-enhanced-vpc-routing-enabled" : "REL02-redshift-enhanced-vpc-routing-enabled",
    "vpc-vpn-2-tunnels-up" : "REL02-vpc-vpn-2-tunnels-up",
    "lambda-vpc-multi-az-check" : "REL02-lambda-vpc-multi-az-check",
    "rds-cluster-multi-az-enabled" : "REL02-rds-cluster-multi-az-enabled",
    "beanstalk-enhanced-health-reporting-enabled" : "REL06-beanstalk-enhanced-health-reporting-enabled",
    "cloudwatch-alarm-action-check" : "REL06-cloudwatch-alarm-action-check",
    "ec2-instance-detailed-monitoring-enabled" : "REL06-ec2-instance-detailed-monitoring-enabled",
    "rds-enhanced-monitoring-enabled" : "REL06-rds-enhanced-monitoring-enabled",
    "dynamodb-autoscaling-enabled" : "REL07-dynamodb-autoscaling-enabled",
    "ec2-instance-managed-by-systems-manager" : "REL04-ec2-instance-managed-by-systems-manager",
    "lambda-concurrency-check" : "REL01-lambda-concurrency-check",
    "rds-instance-deletion-protection-enabled" : "REL04-rds-instance-deletion-protection-enabled",
    "autoscaling-capacity-rebalancing" : "REL07-autoscaling-capacity-rebalancing",
    "lambda-vpc-multi-az-check" : "REL02-lambda-vpc-multi-az-check",
    "rds-cluster-multi-az-enabled" : "REL02-rds-cluster-multi-az-enabled",
    "lambda-dlq-check" : "REL05-lambda-dlq-check",
    "cloudtrail-s3-dataevents-enabled" : "REL06-cloudtrail-s3-dataevents-enabled",
    "vpc-flow-logs-enabled" : "REL06-vpc-flow-logs-enabled",
    "opensearch-logs-to-cloudwatch" : "REL06-opensearch-logs-to-cloudwatch",
    "s3-bucket-logging-enabled" : "REL06-s3-bucket-logging-enabled",
    "multi-region-cloudtrail-enabled" : "REL06-multi-region-cloudtrail-enabled",
    #"cloudtrail-enabled" : "REL06-cloudtrail-enabled", Generates issues for "REL06-multi-region-cloudtrail-enabled"
    "guardduty-enabled-centralized" : "REL06-guardduty-enabled-centralized",
    "ecs-container-insights-enabled" : "REL06-ecs-container-insights-enabled",
    "cloud-trail-cloud-watch-logs-enabled" : "REL06-cloud-trail-cloud-watch-logs-enabled",
    "api-gw-xray-enabled" : "REL06-api-gw-xray-enabled",
    "wafv2-logging-enabled" : "REL06-wafv2-logging-enabled",
    "securityhub-enabled" : "REL06-securityhub-enabled",
    "rds-logging-enabled" : "REL06-rds-logging-enabled",
    "elasticsearch-logs-to-cloudwatch" : "REL06-elasticsearch-logs-to-cloudwatch",
    "s3-bucket-replication-enabled" : "REL06-s3-bucket-replication-enabled",
    "elb-logging-enabled" : "REL06-elb-logging-enabled",
    "dynamodb-pitr-enabled" : "REL06-dynamodb-pitr-enabled",
    "api-gw-execution-logging-enabled" : "REL06-api-gw-execution-logging-enabled",
    "elb-deletion-protection-enabled" : "REL07-elb-deletion-protection-enabled",
    "rds-instance-deletion-protection-enabled" : "REL05-rds-instance-deletion-protection-enabled",
    "autoscaling-group-elb-healthcheck-required" : "REL06-autoscaling-group-elb-healthcheck-required",
    "dynamodb-throughput-limit-check" : "REL08-dynamodb-throughput-limit-check",
    "efs-resources-protected-by-backup-plan" : "REL09-efs-resources-protected-by-backup-plan",
    "dynamodb-in-backup-plan" : "REL09-dynamodb-in-backup-plan",
    "ebs-in-backup-plan" : "REL09-ebs-in-backup-plan",
    "efs-in-backup-plan" : "REL09-efs-in-backup-plan",
    "elasticache-redis-cluster-automatic-backup-check" : "REL09-elasticache-redis-cluster-automatic-backup-check",
    "rds-in-backup-plan" : "REL09-rds-in-backup-plan",
    "redshift-backup-enabled" : "REL09-redshift-backup-enabled",
    "s3-bucket-replication-enabled" : "REL09-s3-bucket-replication-enabled",
    "dynamodb-pitr-enabled" : "REL09-dynamodb-pitr-enabled",
    "rds-automatic-minor-version-upgrade-enabled" : "REL08-rds-automatic-minor-version-upgrade-enabled",
    "elb-deletion-protection-enabled" : "REL08-elb-deletion-protection-enabled",
    "beanstalk-enhanced-health-reporting-enabled" : "REL09-beanstalk-enhanced-health-reporting-enabled",
    "ec2-ebs-encryption-by-default" : "REL09-ec2-ebs-encryption-by-default",
    "s3-bucket-default-lock-enabled" : "REL09-s3-bucket-default-lock-enabled",
    "aurora-resources-protected-by-backup-plan" : "REL09-aurora-resources-protected-by-backup-plan",
    "s3-bucket-server-side-encryption-enabled" : "REL09-s3-bucket-server-side-encryption-enabled",
    "ec2-instance-detailed-monitoring-enabled" : "REL09-ec2-instance-detailed-monitoring-enabled",
    "ebs-optimized-instance" : "REL09-ebs-optimized-instance",
    "rds-snapshot-encrypted" : "REL09-rds-snapshot-encrypted",
    "backup-recovery-point-encrypted" : "REL09-backup-recovery-point-encrypted",
    "backup-plan-min-frequency-and-min-retention-check" : "REL09-backup-plan-min-frequency-and-min-retention-check",
    "dynamodb-table-encrypted-kms" : "REL09-dynamodb-table-encrypted-kms",
    "rds-enhanced-monitoring-enabled" : "REL06-rds-enhanced-monitoring-enabled",
    "rds-storage-encrypted" : "REL09-rds-storage-encrypted",
    "efs-encrypted-check" : "REL09-efs-encrypted-check",
    "backup-recovery-point-minimum-retention-check" : "REL09-backup-recovery-point-minimum-retention-check",
    "fsx-resources-protected-by-backup-plan" : "REL09-fsx-resources-protected-by-backup-plan",
    "s3-default-encryption-kms" : "REL09-s3-default-encryption-kms",
    "encrypted-volumes" : "REL09-encrypted-volumes",
    "s3-bucket-versioning-enabled" : "REL09-s3-bucket-versioning-enabled",
    "redshift-cluster-kms-enabled" : "REL09-redshift-cluster-kms-enabled",
    "db-instance-backup-enabled" : "REL09-db-instance-backup-enabled",
    "ec2-resources-protected-by-backup-plan" : "REL09-ec2-resources-protected-by-backup-plan",
    "elbv2-multiple-az" : "REL10-elbv2-multiple-az",
    "clb-multiple-az" : "REL10-clb-multiple-az",
    "ec2-instance-managed-by-systems-manager" : "REL10-ec2-instance-managed-by-systems-manager",
    "ec2-managedinstance-association-compliance-status-check" : "REL10-ec2-managedinstance-association-compliance-status-check",
    "ec2-managedinstance-patch-compliance-status-check" : "REL10-ec2-managedinstance-patch-compliance-status-check",
    "elastic-beanstalk-managed-updates-enabled" : "REL10-elastic-beanstalk-managed-updates-enabled",
    "opensearch-data-node-fault-tolerance" : "REL10-opensearch-data-node-fault-tolerance",
    "redshift-cluster-maintenancesettings-check" : "REL10-redshift-cluster-maintenancesettings-check",
    "dynamodb-autoscaling-enabled" : "REL07-dynamodb-autoscaling-enabled",
    "autoscaling-capacity-rebalancing" : "REL07-autoscaling-capacity-rebalancing"
  }
}
